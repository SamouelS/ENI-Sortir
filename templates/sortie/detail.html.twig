{% extends 'base.html.twig' %}
{% block navbar %}
    {% include "inc/navbar.html.twig" %}
{% endblock %}
{% block title %}
	Les sorties
{% endblock %}
{% block header %}
	{% include "inc/header.html.twig" %}
{% endblock %}
{% block content %}
    <h1>
        {{ sortie.getNom() }}
        <small class="text-muted">({{ sortie.participants|length }}/{{ sortie.getNbInscriptionsMax() }} participants)</small>
    </h1>
    <h5>
        Organisée par : <a href="{{ path('user_profile', {id: sortie.getOrganisateur().getId()}) }}" title="Voir le profil de {{ sortie.getOrganisateur().getPrenom() }} {{ sortie.getOrganisateur().getNom()|upper }}"> {{ sortie.getOrganisateur().getPrenom() }} {{ sortie.getOrganisateur().getNom()|upper }}</a>
        {% if sortie.getOrganisateur().getId() == app.user.id %}
            <small class="text-muted">(c'est vous !)</small>
        {% endif %}
    </h5>
    <hr>

    <div class="row mb-4">
        <div class="col-md-4">
            <span class="font-weight-bold">Date de la sortie</span>
            <div>
                {{ sortie.getDateHeureDebut()|date('d/m/Y à H:i') }}
            </div>
        </div>

        <div class="col-md-4">
            <span class="font-weight-bold">Fin des inscriptions</span>
            <div>
                {{ sortie.getDateLimiteInscription()| date('d/m/Y à H:i') }}
            </div>
        </div>

        <div class="col-md-4">
            <span class="font-weight-bold">Durée</span>
            <div>
                {{ sortie.getDuree()|date('H:i') }}
            </div>
        </div>
    </div>

    <div class="row mb-4">
        <div class="col-md-4">
            <span class="font-weight-bold">Campus</span>
            <div>
                {{ sortie.getCampus().getNom() }}
            </div>
        </div>

        <div class="col-md-4">
            <span class="font-weight-bold">Lieu</span>
            <div>
                {{ sortie.getLieu().getNom() }}
            </div>
        </div>

        <div class="col-md-4">
            <span class="font-weight-bold">Adresse</span>
            <div>
                {{ sortie.getLieu().getRue() }} {{ sortie.getLieu().getVille().getNom() }} ({{ sortie.getLieu().getVille().getCp() }})
                <div>
                    <small class="text-muted">Latitude: {{ sortie.getLieu().getLatitude() }} Longitude: {{ sortie.getLieu().getLongitude() }}</small>
                </div>
            </div>
        </div>
    </div>
    <div class="row mb-4">
        <div class="col-md-12">
            <span class="font-weight-bold">Description</span>
            <div>
                {{ sortie.getInfosSortie() }}
            </div>
        </div>
    </div>
    <hr />
    <div class="row">
        <div class="col-md-12">
            <span class="font-weight-bold">Participants</span>
            <table id="table" class="table table-striped table-bordered display responsive nowrap" style="width:100%">
                <thead>
                <th>Email</th>
                <th>Nom</th>
                </thead>
                <tbody>
                    {% for participant in sortie.participants %}
                        <tr>
                            <td>
                                <a href="{{ path("user_profile", {"id": participant.id }) }}">
                                    {{ participant.mail }}
                                </a>
                            </td>
                            <td>{{ participant.prenom }} {{ participant.nom|upper }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    <hr>
    <span class="font-weight-bold">Actions</span><br>
    {% if app.user in sortie.participants %}
        <td><a class="btn btn-primary" href="{{path('sortie_unsubscribe', {'idSortie': sortie.id, 'idParticipant': app.user.id} )}}">Se désister</a></td>
    {% else %}
        {% if sortie.participants|length >= sortie.getNbInscriptionsMax() or "now"|date("d/m/Y") > sortie.getDateLimiteInscription()|date("d/m/Y") %}
            <td><a class="btn btn-secondary" href="#" disabled>S'inscrire</a></td>
        {% else %}
            <td><a class="btn btn-primary" href="{{path('sortie_register', {'idSortie': sortie.id, 'idParticipant': app.user.id} )}}">S'inscrire</a></td>
        {% endif %}
    {% endif %}

<button type="button" class="btn btn-secondary">Secondary</button>
<button type="button" class="btn btn-success">Success</button>

    
{% endblock %}